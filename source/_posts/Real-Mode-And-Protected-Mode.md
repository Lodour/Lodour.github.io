title: 实模式和保护模式
categories: 操作系统
tags:
  - 操作系统
  - 实模式
  - 保护模式
date: 2016-12-04 20:13:15
---

实模式和保护模式都是x86芯片下CPU的运行模式。

实模式是为了向前兼容而存在，如今大多系统都在保护模式下运行。

本文简要介绍了两种模式的主要区别，以及为何需要区分这两种模式。

<!--more-->

# Intel 8086/8088
早期的8086CPU，数据总线16位，地址总线20位，寄存器16位。

20位可以表示的地址为`0x00000~0xfffff`，即1MB。

16位可以表示的地址为`0x00000~0x0ffff`，即64KB。

于是问题来了，内存有1MB，但是寻址范围只有64KB。

为了解决这个问题，采取了分段寻址的模式，即16位段地址左移4位后加上16位偏移地址。

在分段寻址模式下，我们计算其最大寻址范围：

DS = 0xffff, SI = 0xffff

DS << 4 + SI = 0xffff0 + 0xffff = 0xfffff + 0xfff0

我们发现，这种寻址方式不仅可以访问到完整的1MB，还多出了额外的65520(0xfff0)B。

由于地址总线只有20位，也就无法访问1MB外的内容。但目前为止我们已经取得的成果是，通过16位的数据总线，访问了20位的地址。

实际上，我们是将内存分为了若干个段，每个段的大小为64KB（通过数据总线可以直接完全访问），段地址左移后溢出的四位，作为每个段的编号(0x0~0xf)。

也即是，我们通过段地址的高4位**选择**了一个段，通过段地址的低12位和偏移地址组合访问了某一个确定的段内的64KB内存。

# Intel 80286
80286是一个分水岭，发展到80286之后的CPU，以80286为例，数据总线16位，地址总线24位，于是可寻址内存达到了16MB。

于是问题来了，之前的分段寻址已经没用了，由此产生了段选择寻址，但是为了和之前的CPU兼容：

1. 数据总线16位，段基地址+段内偏移，称为**实模式**，只能访问1MB内存。

2. 数据总线32位，段选择符+段内偏移，称为**保护模式**，可以访问更多内存。

3. 为了向前兼容，计算机通电后首先在实模式运行，由启动程序选择进入保护模式。

【未完待续...】
